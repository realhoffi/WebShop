<!DOCTYPE html>
<html ng-app="appAusgabenmanager">
<head lang="de">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ausgabenmanager</title>
    <link href="../css/bootstrap.css" type="text/css" rel="stylesheet">
    <script src="../js/jquery-1.11.0.min.js" type="application/javascript"></script>
    <script src="../js/bootstrap.js" type="application/javascript"></script>
    <script src="../js/angular.js" type="application/javascript"></script>
    <script src="../js/ui-bootstrap-tpls-0.11.0.js" type="application/javascript"></script>
    <script src="../angular/app.js" type="application/javascript"></script>
    <script src="../angular/controller.js" type="application/javascript"></script>
    <script src="../angular/appHelper.js" type="application/javascript"></script>
    <script type="text/javascript">
        var user = function () {
            var self = this;
            self.Email = '';
            self.Nachname = '';
            self.Vorname = '';

        };
        var uid = '';

        $(document).ready(function () {
            $(".btnGo").click(function () {
                createUser();
            });
            $("#uploadFile").click(function () {
                upload();
            });
        });
        function upload() {
            var fileContent = $("#fileInput")[0];
            var file = fileContent.files[0];
            var name = file.name;
            var size = file.size;
            var type = file.type;


            var reader = new FileReader();

            reader.onload = function (event) {
                console.log(event.target);
            };
            console.log(file);
            reader.readAsDataURL(file);

            var xhr = new XMLHttpRequest();
            xhr.upload.onprogress = function (e) {
                var percent = ((100 * e.loaded) / e.total);
                // Render a pretty progress bar
            };
            xhr.onreadystatechange = function (e) {
                if (e.target.readyState == 4) {
                    // Handle file upload complete
                    alert('ready');
                } else if (e.target.readyState == 2) {
                    alert(e.target.status + " : " + e.target.statusText);
                }
            };
            //  xhr.open('POST', 'http://localhost:54091/File/SaveFile?fid=' + name, true);
            xhr.open('POST', 'http://info.fhoffma.net/services/File/SaveFile?fid=' + name, true);
            xhr.setRequestHeader('X-FileName', name); // Pass the filename along
            xhr.send(file);
        }
        function createUser() {
            var b = new user();
            b.Email = "flo@test.de";
            b.Nachname = "NNAME";
            b.Vorname = "FLORI";

            //var domain = "http://localhost:54091/";
            var domain = "http://info.fhoffma.net/services/";
            var aj = $.ajax({
                url: domain + "users/Register",
                type: "POST",
                data: JSON.stringify(b),
                contentType: 'application/json; charset=UTF-8',
                dataType: 'json',
                success: function (data, textStatus, jqXHR) {
                    var c = data;
                    alert(JSON.stringify(c));
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('fail');
                }
            });
        }
    </script>
    <style type="text/css">
        .vcenter {
            display: inline-block;
            vertical-align: middle;
            float: none;
            border-color: #428bca;
        }

        .controlMaxSize {
            width: 100%;
        }
    </style>
</head>
<body>
<div class="container-fluid" ng-controller="ausgabenCtrl">
    <div class="row">
        <div class="col-md-12">
            <div class="page-header panel panel-primary">
                <h1 class="text-center">
                    <b> <span class="glyphicon glyphicon-tasks"></span>
                        <span class="text-center"> Ausgabenmanager</span></b>

                </h1>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-success">
                        <a href="#" class="list-group-item active">
                        <b> <span class="glyphicon glyphicon-user"></span> <span>Zusammenfassung</span></b>
                        </a>
                        <a href="#" class="list-group-item">
                            <span class="glyphicon "></span> Meine monatlichenAusgaben
                        </a>
                        <a href="#" class="list-group-item">
                            <span class="glyphicon "></span> Meine monatlichenAusgaben
                        </a>
                        <a href="#" class="list-group-item">
                            <span class="glyphicon "></span> Kostenkalkulation
                        </a>

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-success">
                        <a href="#" class="list-group-item active">
                            <b> <span class="glyphicon glyphicon-user"></span> <span>Charts</span></b>
                        </a>
                        <a href="#" class="list-group-item">
                            <span class="glyphicon "></span> Google
                        </a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-success">
                        <a href="#" class="list-group-item active">
                            <b> <span class="glyphicon glyphicon-star"></span> <span>Meine Favoriten</span></b>
                        </a>
                        <a href="#" class="list-group-item">
                            <span class="glyphicon "></span> Favorit 1
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8" id="content">
            <div class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-5 col-md-offset-1"> Search: <input class="form-control" ng-model="query">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-5 col-md-offset-1"> Sort by:
                            <select class="form-control" ng-model="orderProp">
                                <option value="Beschreibung">Beschreibung</option>
                                <option value="Name">Name</option>
                                <option value="Ausgabezeitraum">Ausgabezeitraum</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class='row'>
                <div class='span12'>
                    <hr>
                </div>
            </div>
            <div class='row'>
                <div class='span12'>
                    {{ currentUser }}
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="panel-group col-md-offset-1 " id="ausgabenAccordion"
                         ng-repeat="ausgabe in Ausgaben | filter:query | orderBy: orderProp">
                        <div class="panel panel-primary">
                            <div class="panel-heading ">
                                <h4 class="panel-title">
                                    <b>
                                        <a data-toggle="collapse" data-parent="#ausgabenAccordion"
                                           class="list-group-item active"
                                           href="#acc{{ausgabe.ID}}">
                                            {{ausgabe.Name}}
                                        </a>
                                    </b>
                                </h4>
                            </div>
                            <div id="acc{{ausgabe.ID}}" class="panel-collapse collapse in">
                                <div class="panel-body">
                                    <form class="form-horizontal" role="form">
                                        <div class="form-group">
                                            <h4 class="col-sm-2">
                                                <span class=" label label-primary">Beschreibung:</span>
                                            </h4>

                                            <div class="col-sm-10">
                                                <input type="text" class="form-control "
                                                       ng-model="ausgabe.Beschreibung"
                                                       readonly>
                                            </div>

                                        </div>
                                        <div class="form-group">
                                            <h4 class="col-sm-2">
                                                <span class="label label-primary">Ausgabezeitraum:</span>
                                            </h4>

                                            <div class="col-sm-6">
                                                <select class="form-control"
                                                        ng-model="ausgabe.Ausgabezeitraum"
                                                        ng-change="updateAusgabe(ausgabe.Ausgabezeitraum,ausgabe)"
                                                        ng-options="choice.ID as choice.Name for choice in Ausgabenzeitraeume">
                                                    <option value="">-- Ausgabezeitraum ausw√§hlen --</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-success">
                        <button class="btn btn-primary btn-lg btn-block" ng-click="OpenNeueAufgabe('lg')">Neue Ausgabe
                        </button>
                        <button class="btn btn-primary btn-lg btn-block" ng-click="LogIn()">LogIn</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="panel-footer">
            <div class="col-md-12 alert alert-info">Keine Fragen erlaubt.</div>
        </div>
    </div>
</div>
</body>
</html>